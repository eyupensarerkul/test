<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Görev Yönetim Panosu</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* CSS STİLLERİ (Öncekine Eklemeler ve İyileştirmeler) */
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --primary-color: #bb86fc; 
            --secondary-color: #03dac6; 
            --card-bg: #1e1e1e;
            --border-color: #333333;
            --error-color: #cf6679; /* Kırmızımsı hata/silme rengi */
        }
        
        /* Genel Stil ve Navigasyon (Kısaltıldı) */
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; padding-bottom: 70px; }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24 }
        .board-content { padding: 20px; max-width: 1000px; margin: 0 auto; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; min-height: 80vh; }
        .tab-content.active { display: block; }
        .widget-card { background-color: var(--card-bg); padding: 25px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); }
        h2 { color: var(--primary-color); margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; font-weight: 500; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; background-color: var(--card-bg); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5); z-index: 1000; }
        .nav-item { color: var(--text-color); text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px; cursor: pointer; transition: color 0.2s; font-size: 0.75rem; font-weight: 500; gap: 2px; opacity: 0.6; }
        .nav-item.active, .nav-item:hover { color: var(--primary-color); opacity: 1; }
        .nav-item.active .material-symbols-outlined { font-variation-settings: 'FILL' 1; }

        /* Takvim ve Görev Yönetimi Stilleri */
        .takvim-baslik, .gorev-ekle { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .takvim-baslik button { background-color: var(--secondary-color); color: var(--bg-color); border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
        .takvim-gunler { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .takvim-hucre { padding: 10px 0; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, color 0.2s; font-size: 0.9rem; position: relative; }
        .takvim-hucre.dolu:hover { background-color: var(--secondary-color); color: var(--bg-color); }
        .takvim-hucre.bugun { background-color: var(--primary-color); color: var(--bg-color); font-weight: bold; }
        
        .gorevli { 
            border: 2px solid var(--error-color); 
            box-shadow: 0 0 5px var(--error-color);
        }

        /* Görev Listesi Stili */
        #gorev-listesi { margin-top: 20px; padding: 0; list-style: none; }
        .gorev-item {
            background-color: var(--bg-color);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 5px solid var(--secondary-color);
        }

        .gorev-sil-btn {
            background: none;
            border: none;
            color: var(--error-color);
            cursor: pointer;
            padding: 5px;
            margin-left: 10px;
        }

        .gorev-detay {
            flex-grow: 1;
        }

        .gorev-detay strong {
            display: block;
            font-size: 1.1em;
        }

        .gorev-alarm {
            font-size: 0.8em;
            color: var(--primary-color);
        }

        /* Görev Ekleme Formu Stili */
        .gorev-ekle input, .gorev-ekle button {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .gorev-ekle button {
            background-color: var(--primary-color);
            color: var(--bg-color);
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Zil Sesi için gizli Audio elemanı */
        #alarm-sesi { display: none; }
    </style>
</head>
<body>

    <div class="board-content">
        
        <div id="home" class="tab-content active">
            <div class="widget-card">
                <h2>Anlık Saat ve Tarih</h2>
                <div id="saat-gostergesi" class="display-large"></div>
                <div id="tarih-gostergesi"></div>
            </div>
        </div>

        <div id="time_management" class="tab-content">
            <div class="widget-card">
                <h2>Kronometre (Stopwatch)</h2>
                <div id="stopwatch-display" class="display-large">00:00:00</div>
                <div class="timer-controls">
                    <button id="sw-start-btn" onclick="startStopwatch()"><span class="material-symbols-outlined">play_arrow</span> Başlat</button>
                    <button id="sw-pause-btn" onclick="pauseStopwatch()" style="display:none;"><span class="material-symbols-outlined">pause</span> Duraklat</button>
                    <button onclick="resetStopwatch()"><span class="material-symbols-outlined">restart_alt</span> Sıfırla</button>
                </div>
            </div>

            <div class="widget-card">
                <h2>Geri Sayım Zamanlayıcısı (Timer)</h2>
                <div class="countdown-setup">
                    <input type="number" id="timer-hours" value="0" min="0" max="23"> <label>saat</label>
                    <input type="number" id="timer-minutes" value="5" min="0" max="59"> <label>dakika</label>
                    <input type="number" id="timer-seconds" value="0" min="0" max="59"> <label>saniye</label>
                </div>
                <div id="timer-display" class="display-large">00:05:00</div>
                <div class="timer-controls">
                    <button id="timer-start-btn" onclick="startTimer()"><span class="material-symbols-outlined">play_arrow</span> Başlat</button>
                    <button id="timer-pause-btn" onclick="pauseTimer()" style="display:none;"><span class="material-symbols-outlined">pause</span> Duraklat</button>
                    <button onclick="resetTimer()"><span class="material-symbols-outlined">restart_alt</span> Sıfırla</button>
                </div>
            </div>
        </div>

        <div id="notes" class="tab-content">
            <div class="widget-card">
                <h2>Hızlı Notlar (Kalıcı)</h2>
                <textarea id="not-alani" placeholder="Buraya önemli notlarınızı yazın. Tarayıcınız kapatılsa bile bu notlar saklanacaktır."></textarea>
            </div>
        </div>

        <div id="calendar" class="tab-content">
            <div class="widget-card">
                <h2>Takvim</h2>
                <div class="takvim-baslik">
                    <button onclick="takvimiDegistir(-1)"> &lt; </button>
                    <div id="takvim-ay-yil"></div>
                    <button onclick="takvimiDegistir(1)"> &gt; </button>
                </div>
                <div class="takvim-gunler">
                    <div class="takvim-gun">Pzt</div>
                    <div class="takvim-gun">Sal</div>
                    <div class="takvim-gun">Çar</div>
                    <div class="takvim-gun">Per</div>
                    <div class="takvim-gun">Cum</div>
                    <div class="takvim-gun">Cmt</div>
                    <div class="takvim-gun">Paz</div>
                </div>
                <div id="takvim-hucreler" class="takvim-gunler">
                    </div>
            </div>

            <div class="widget-card">
                <h2>Seçilen Günün Görevleri (<span id="secilen-tarih-gostergesi">Bugün</span>)</h2>
                
                <div class="gorev-ekle">
                    <input type="text" id="gorev-metni" placeholder="Görevi buraya yazın..." style="flex: 2;">
                    <input type="time" id="gorev-alarm-saati" value="09:00" style="width: 100px;">
                    <button onclick="gorevEkle()">
                        <span class="material-symbols-outlined">add_task</span> Ekle
                    </button>
                </div>
                
                <ul id="gorev-listesi">
                    </ul>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a class="nav-item active" data-tab="home"><span class="material-symbols-outlined">home</span><span>Ana Sayfa</span></a>
        <a class="nav-item" data-tab="time_management"><span class="material-symbols-outlined">timer</span><span>Zaman Yön.</span></a>
        <a class="nav-item" data-tab="notes"><span class="material-symbols-outlined">note_alt</span><span>Notlar</span></a>
        <a class="nav-item" data-tab="calendar"><span class="material-symbols-outlined">calendar_month</span><span>Takvim</span></a>
    </div>

    <audio id="alarm-sesi" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>

    <script>
        /* JAVASCRIPT FONKSİYONLARI */
        
        const alarmSesi = document.getElementById('alarm-sesi');
        const GOREV_KEY = 'minimal_koyu_gorevler';
        let gorevler = JSON.parse(localStorage.getItem(GOREV_KEY)) || {};
        let aktifTarih = new Date(); // Takvim için kullanılan ay/yıl
        let secilenTarih = new Date(); // Görevler için seçilen gün
        let alarmKontrolInterval; // Alarm kontrol döngüsü

        // ------------------------------------
        // GENEL YARDIMCI VE ZAMAN FONKSİYONLARI
        // ------------------------------------

        function tarihFormatla(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        
        function gosterSekme(tabId) {
            // ... (Önceki koddan)
            document.querySelectorAll('.tab-content').forEach(content => { content.classList.remove('active'); });
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => { item.classList.remove('active'); });
            document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');

            if (tabId !== 'time_management') {
                pauseStopwatch();
                pauseTimer();
            }
            if (tabId === 'calendar') {
                // Takvime geçildiğinde günün görevlerini yükle
                gorevleriYukle(tarihFormatla(secilenTarih));
                takvimiOlustur(aktifTarih); // Güncel ayın görev işaretlerini yenile
            }
        }
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() { gosterSekme(this.getAttribute('data-tab')); });
        });

        // Alarm Kontrolü Başlat
        function alarmKontrolBaslat() {
            if (alarmKontrolInterval) clearInterval(alarmKontrolInterval);
            alarmKontrolInterval = setInterval(alarmKontrolEt, 5000); // Her 5 saniyede bir kontrol et
        }

        // Tarayıcı Bildirim İzni Kontrolü
        function izinIste() {
            if (!("Notification" in window)) return;
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        }

        // ------------------------------------
        // GÖREV, ALARM VE NOT FONKSİYONLARI
        // ------------------------------------
        
        function gorevleriKaydet() {
            localStorage.setItem(GOREV_KEY, JSON.stringify(gorevler));
            takvimiOlustur(aktifTarih); // Görev eklenince takvimdeki günü işaretle
        }

        function gorevleriYukle(tarihStr) {
            const gorevListesiUL = document.getElementById('gorev-listesi');
            const gorevlerBugun = gorevler[tarihStr] || [];
            gorevListesiUL.innerHTML = '';
            document.getElementById('secilen-tarih-gostergesi').textContent = 
                tarihStr === tarihFormatla(new Date()) ? "Bugün" : tarihStr;

            if (gorevlerBugun.length === 0) {
                gorevListesiUL.innerHTML = `<li style="opacity: 0.6; text-align: center;">Bu güne ait görev bulunmamaktadır.</li>`;
                return;
            }

            gorevlerBugun.forEach((gorev, index) => {
                const li = document.createElement('li');
                li.className = 'gorev-item';
                li.innerHTML = `
                    <div class="gorev-detay">
                        <strong>${gorev.metin}</strong>
                        <span class="gorev-alarm">
                            <span class="material-symbols-outlined" style="font-size: 14px;">alarm</span>
                            Alarm: ${gorev.alarm}
                        </span>
                    </div>
                    <button class="gorev-sil-btn" onclick="gorevSil('${tarihStr}', ${index})">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                `;
                gorevListesiUL.appendChild(li);
            });
        }

        function gorevEkle() {
            const metinInput = document.getElementById('gorev-metni');
            const alarmInput = document.getElementById('gorev-alarm-saati');
            const metin = metinInput.value.trim();
            const alarmSaati = alarmInput.value;
            const tarihStr = tarihFormatla(secilenTarih);

            if (metin === "") {
                alert("Lütfen bir görev metni girin.");
                return;
            }
            
            // Eğer o gün için görev yoksa boş dizi oluştur
            if (!gorevler[tarihStr]) {
                gorevler[tarihStr] = [];
            }

            gorevler[tarihStr].push({ 
                metin: metin, 
                alarm: alarmSaati, 
                tamamlandi: false,
                caldi: false
            });

            metinInput.value = "";
            gorevleriKaydet();
            gorevleriYukle(tarihStr);
        }

        function gorevSil(tarihStr, index) {
            if (confirm("Bu görevi silmek istediğinizden emin misiniz?")) {
                if (gorevler[tarihStr]) {
                    gorevler[tarihStr].splice(index, 1);
                    if (gorevler[tarihStr].length === 0) {
                        delete gorevler[tarihStr]; // Boşalan günü sil
                    }
                    gorevleriKaydet();
                    gorevleriYukle(tarihStr);
                }
            }
        }
        
        function alarmKontrolEt() {
            const simdi = new Date();
            const simdiTarihStr = tarihFormatla(simdi);
            const simdiSaatStr = `${String(simdi.getHours()).padStart(2, '0')}:${String(simdi.getMinutes()).padStart(2, '0')}`;
            
            if (gorevler[simdiTarihStr]) {
                gorevler[simdiTarihStr].forEach(gorev => {
                    // Alarm saati geldi mi ve daha önce çalmadı mı?
                    if (gorev.alarm === simdiSaatStr && !gorev.caldi) {
                        
                        // Alarmı çal (Ses ve Bildirim)
                        alarmCal(gorev.metin); 
                        
                        // Alarmı çaldı olarak işaretle
                        gorev.caldi = true; 
                        gorevleriKaydet(); 
                    }
                });
            }
        }

        function alarmCal(gorevMetni) {
            // Zil Sesini Çal
            alarmSesi.play().catch(e => console.error("Ses çalınamadı:", e));
            
            // Tarayıcı Bildirimi Göster
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification("GÖREV ALARMI!", {
                    body: `Zamanı Geldi: ${gorevMetni}`,
                    icon: "https://fonts.gstatic.com/s/materialsymbolsoutlined/v164/vSgAU_MofcQo7pOHiLh35QNnJ-Y0p8E_5Gf4x4yO3w.woff2" // Alternatif ikon linki
                });
            } else {
                alert(`Alarm! Görev zamanı geldi: ${gorevMetni}`);
            }
        }

        // Kalıcı Notlar (Önceki Koddan)
        const notAlani = document.getElementById('not-alani');
        const NOT_KEY = 'minimal_koyu_notlar_v2';
        notAlani.value = localStorage.getItem(NOT_KEY) || '';
        notAlani.addEventListener('input', () => {
            localStorage.setItem(NOT_KEY, notAlani.value);
        });
        
        // ------------------------------------
        // TAKVİM FONKSİYONLARI (GÖREV İŞARETLEMELERİ İLE)
        // ------------------------------------
        
        function takvimiOlustur(date) {
            // ... (Önceki Koddan gerekli değişkenler)
            const yil = date.getFullYear();
            const ay = date.getMonth();
            const bugun = new Date(); 
            const ayIsimleri = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
            const ayYilGostergesi = document.getElementById('takvim-ay-yil');
            const takvimHucreler = document.getElementById('takvim-hucreler');
            
            if (!ayYilGostergesi || !takvimHucreler) return; 

            ayYilGostergesi.textContent = `${ayIsimleri[ay]} ${yil}`;
            const ayinIlkGunu = new Date(yil, ay, 1);
            let baslangicGunu = ayinIlkGunu.getDay();
            if (baslangicGunu === 0) baslangicGunu = 7; 
            const gunSayisi = new Date(yil, ay + 1, 0).getDate();
            takvimHucreler.innerHTML = ''; 

            for (let i = 1; i < baslangicGunu; i++) {
                const hucre = document.createElement('div');
                hucre.classList.add('takvim-hucre', 'bos');
                takvimHucreler.appendChild(hucre);
            }

            for (let i = 1; i <= gunSayisi; i++) {
                const hucre = document.createElement('div');
                hucre.classList.add('takvim-hucre', 'dolu');
                hucre.textContent = i;

                const oAnkiGun = new Date(yil, ay, i);
                const tarihStr = tarihFormatla(oAnkiGun);

                // Bugünün Tarihini İşaretle
                if (oAnkiGun.toDateString() === bugun.toDateString()) {
                    hucre.classList.add('bugun');
                }
                
                // Seçilen Tarihi İşaretle
                if (oAnkiGun.toDateString() === secilenTarih.toDateString()) {
                     hucre.style.outline = `3px solid ${i === bugun.getDate() && ay === bugun.getMonth() ? 'white' : 'yellow'}`;
                }

                // Görev Olan Günleri İşaretle
                if (gorevler[tarihStr] && gorevler[tarihStr].length > 0) {
                    hucre.classList.add('gorevli');
                }
                
                // Tıklama Olayı: Günü seç ve görevleri yükle
                hucre.onclick = () => {
                    secilenTarih = oAnkiGun;
                    gorevleriYukle(tarihStr);
                    takvimiOlustur(aktifTarih); // Seçim rengini yenile
                };

                takvimHucreler.appendChild(hucre);
            }
        }

        function takvimiDegistir(delta) {
            aktifTarih.setMonth(aktifTarih.getMonth() + delta);
            takvimiOlustur(aktifTarih);
        }

        // ------------------------------------
        // KRONOMETRE ve ZAMANLAYICI FONKSİYONLARI (Önceki koddan alınmıştır)
        // ------------------------------------
        let swInterval; let swRunning = false; let swElapsedTime = 0;
        const swDisplay = document.getElementById('stopwatch-display');
        const swStartBtn = document.getElementById('sw-start-btn');
        const swPauseBtn = document.getElementById('sw-pause-btn');
        
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
            const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        function formatSeconds(totalSeconds) { return formatTime(totalSeconds * 1000); }
        function startStopwatch() { if (swRunning) return; swRunning = true; const swStartTime = Date.now() - swElapsedTime; swInterval = setInterval(() => { swElapsedTime = Date.now() - swStartTime; swDisplay.textContent = formatTime(swElapsedTime); }, 1000); swStartBtn.style.display = 'none'; swPauseBtn.style.display = 'inline-flex'; }
        function pauseStopwatch() { if (!swRunning) return; swRunning = false; clearInterval(swInterval); swStartBtn.style.display = 'inline-flex'; swPauseBtn.style.display = 'none'; }
        function resetStopwatch() { pauseStopwatch(); swElapsedTime = 0; swDisplay.textContent = formatTime(swElapsedTime); }
        
        let timerInterval; let timerRunning = false; let remainingSeconds = 300; let initialSeconds = 300;
        const timerDisplay = document.getElementById('timer-display');
        const timerStartBtn = document.getElementById('timer-start-btn');
        const timerPauseBtn = document.getElementById('timer-pause-btn');
        const hInput = document.getElementById('timer-hours');
        const mInput = document.getElementById('timer-minutes');
        const sInput = document.getElementById('timer-seconds');
        
        function updateRemainingTime() {
            if (remainingSeconds <= 0) {
                clearInterval(timerInterval); timerRunning = false; timerDisplay.textContent = "00:00:00"; 
                alarmCal("Zamanlayıcı Geri Sayımı Sona Erdi!");
                timerStartBtn.style.display = 'inline-flex'; timerPauseBtn.style.display = 'none';
                return;
            }
            timerDisplay.textContent = formatSeconds(remainingSeconds);
            remainingSeconds--;
        }
        function setInitialTime() {
            const hours = parseInt(hInput.value) || 0; const minutes = parseInt(mInput.value) || 0; const seconds = parseInt(sInput.value) || 0;
            const newTotalSeconds = (hours * 3600) + (minutes * 60) + seconds;
            if (newTotalSeconds > 0) { initialSeconds = newTotalSeconds; remainingSeconds = newTotalSeconds; } 
            else { initialSeconds = 300; remainingSeconds = 300; }
            timerDisplay.textContent = formatSeconds(remainingSeconds);
            timerStartBtn.style.display = 'inline-flex'; timerPauseBtn.style.display = 'none';
        }
        [hInput, mInput, sInput].forEach(input => { input.addEventListener('input', () => { pauseTimer(); setInitialTime(); }); });
        function startTimer() { if (timerRunning) return; if (remainingSeconds <= 0) { setInitialTime(); if (remainingSeconds <= 0) return; } timerRunning = true; timerInterval = setInterval(updateRemainingTime, 1000); timerStartBtn.style.display = 'none'; timerPauseBtn.style.display = 'inline-flex'; }
        function pauseTimer() { if (!timerRunning) return; timerRunning = false; clearInterval(timerInterval); timerStartBtn.style.display = 'inline-flex'; timerPauseBtn.style.display = 'none'; }
        function resetTimer() { pauseTimer(); remainingSeconds = initialSeconds; timerDisplay.textContent = formatSeconds(remainingSeconds); hInput.value = Math.floor(initialSeconds / 3600); mInput.value = Math.floor((initialSeconds % 3600) / 60); sInput.value = initialSeconds % 60; }
        setInitialTime();

        // ------------------------------------
        // İLK BAŞLATMA İŞLEMLERİ
        // ------------------------------------
        saatiGuncelle();
        takvimiOlustur(aktifTarih); 
        gorevleriYukle(tarihFormatla(secilenTarih)); 
        izinIste(); // Bildirim izni iste
        alarmKontrolBaslat(); // Alarm kontrolünü başlat
    </script>
</body>
</html>
