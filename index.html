<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tema Seçimli Yönetim Panosu</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* CSS STİLLERİ (TEMA DEĞİŞKENLERİ) */
        :root {
            /* Varsayılan Tema (Deep Blue) */
            --bg-color: #0a192f; 
            --text-color: #ccd6f6; 
            --primary-color: #64ffda; 
            --secondary-color: #ccd6f6; 
            --card-bg: #112240; 
            --border-color: #30363d;
            --error-color: #ff6464;
            --delete-button-color: var(--error-color); 
        }
        
        /* Önceki JS bloğu buradan KALDIRILMIŞTIR! */
        
        /* Genel Stiller ve Geçişler */
        body { 
            font-family: 'Roboto', sans-serif; 
            /* Hafif degrade ile derinlik */
            background: linear-gradient(145deg, var(--bg-color), var(--card-bg)); 
            color: var(--text-color); 
            margin: 0; 
            padding: 0; 
            padding-bottom: 70px; 
            transition: all 0.5s ease-in-out; 
        }
        .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24 }
        .board-content { padding: 20px; max-width: 1000px; margin: 0 auto; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; min-height: 80vh; }
        .tab-content.active { display: block; }
        
        /* KART GÖRÜNÜMÜ */
        .widget-card { 
            background-color: var(--card-bg); 
            padding: 25px; 
            margin-bottom: 20px; 
            border-radius: 12px; 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5), 0 0 5px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color); 
            transition: all 0.5s ease-in-out; 
        }
        
        h2 { 
            color: var(--primary-color); 
            margin-top: 0; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 10px; 
            margin-bottom: 20px; 
            font-weight: 500;
            transition: color 0.5s, border-bottom 0.5s;
        }

        /* Navigasyon Stilleri */
        .bottom-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; height: 60px; 
            background-color: var(--card-bg); 
            border-top: 1px solid var(--border-color); 
            display: flex; justify-content: space-around; align-items: center; 
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5); z-index: 1000; 
            transition: background-color 0.5s; 
        }
        .nav-item { color: var(--text-color); text-decoration: none; display: flex; flex-direction: column; align-items: center; cursor: pointer; opacity: 0.7; font-size: 0.75rem; font-weight: 500; gap: 2px; }
        .nav-item.active, .nav-item:hover { color: var(--primary-color); opacity: 1; transition: color 0.3s; }
        .nav-item.active .material-symbols-outlined { font-variation-settings: 'FILL' 1; }
        
        /* Zaman ve Ekran Stilleri */
        .display-large { 
            font-size: 2.5rem; text-align: center; 
            color: var(--primary-color); 
            margin-bottom: 15px; transition: color 0.5s; 
            text-shadow: 0 0 8px rgba(100, 255, 218, 0.7); 
        }
        .timer-controls button, .gorev-ekle button, .theme-select-btn { 
            background-color: var(--primary-color); 
            color: var(--card-bg); 
            border: none; padding: 10px 15px; border-radius: 6px; 
            cursor: pointer; transition: background-color 0.2s, transform 0.1s; 
            display: inline-flex; align-items: center; gap: 5px; font-weight: 500;
        }
        .timer-controls button:hover, .gorev-ekle button:hover, .theme-select-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }
        .timer-controls { display: flex; justify-content: space-around; gap: 10px; }
        .countdown-setup input { width: 40px; text-align: center; padding: 5px; border-radius: 4px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); }

        /* Takvim ve Görev Stilleri */
        .takvim-baslik button {
            background-color: var(--primary-color);
            color: var(--card-bg);
        }
        .takvim-baslik { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .takvim-gunler { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .takvim-hucre { padding: 10px 0; border-radius: 8px; cursor: pointer; position: relative; transition: background-color 0.2s; }
        .takvim-hucre.bugun { 
            background-color: var(--primary-color); 
            color: var(--card-bg); 
            font-weight: bold; 
        }
        .takvim-hucre.secili { /* Seçilen hücreye belirgin bir çerçeve ekle */
            outline: 3px solid var(--error-color); 
            outline-offset: -3px;
        }
        .gorevli { 
            border: 2px solid var(--error-color); 
            box-shadow: 0 0 5px var(--error-color); 
            /* Görevli hücre için renk tonu */
            background-color: color-mix(in srgb, var(--error-color) 15%, transparent); 
        }
        .gorev-item { 
            border-left: 5px solid var(--primary-color); 
            background-color: var(--bg-color); 
            padding: 12px; 
            margin-bottom: 8px; 
            border-radius: 6px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            gap: 10px;
        }
        .gorev-detay { display: flex; flex-direction: column; align-items: flex-start; flex-grow: 1; }
        .gorev-alarm { font-size: 0.8rem; color: var(--secondary-color); display: flex; align-items: center; gap: 3px; margin-top: 3px; }

        /* GÖREV SİLME BUTONU STİLİ */
        .gorev-sil-btn { 
            background-color: transparent !important; 
            color: var(--delete-button-color); 
            padding: 5px; 
            border-radius: 4px; 
            transition: color 0.2s, background-color 0.2s;
            transform: none !important; 
        }
        .gorev-sil-btn:hover {
            background-color: color-mix(in srgb, var(--delete-button-color) 15%, transparent) !important;
            color: var(--delete-button-color) !important;
            filter: none !important;
        }

        .gorev-ekle { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px; }
        .gorev-ekle input, #not-alani { padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); }
        #not-alani { width: 100%; height: 200px; box-sizing: border-box; resize: vertical; font-size: 1rem; }
        
        /* Ayarlar Stilleri (Yeni Tema Seçim Butonları) */
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; }
        .theme-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .theme-card.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
        }
        .theme-preview {
            height: 50px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 5px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>

    <div class="board-content">
        
        <div id="home" class="tab-content active">
            <div class="widget-card">
                <h2>Anlık Saat ve Tarih</h2>
                <div id="saat-gostergesi" class="display-large" style="font-size: 3.5rem;"></div>
                <div id="tarih-gostergesi" style="text-align: center; color: var(--secondary-color);"></div>
            </div>
        </div>

        <div id="time_management" class="tab-content">
            <div class="widget-card">
                <h2>Kronometre (Stopwatch)</h2>
                <div id="stopwatch-display" class="display-large">00:00:00</div>
                <div class="timer-controls">
                    <button id="sw-start-btn" onclick="startStopwatch()"><span class="material-symbols-outlined">play_circle</span> Başlat</button>
                    <button id="sw-pause-btn" onclick="pauseStopwatch()" style="display:none;"><span class="material-symbols-outlined">pause_circle</span> Duraklat</button>
                    <button onclick="resetStopwatch()"><span class="material-symbols-outlined">restart_alt</span> Sıfırla</button>
                </div>
            </div>

            <div class="widget-card">
                <h2>Geri Sayım Zamanlayıcısı (Timer)</h2>
                <div style="text-align: center; margin-bottom: 10px;">
                    <input type="number" id="timer-hours" value="0" min="0" max="23"> <label>saat</label>
                    <input type="number" id="timer-minutes" value="5" min="0" max="59"> <label>dakika</label>
                    <input type="number" id="timer-seconds" value="0" min="0" max="59"> <label>saniye</label>
                </div>
                <div id="timer-display" class="display-large">00:05:00</div>
                <div class="timer-controls">
                    <button id="timer-start-btn" onclick="startTimer()"><span class="material-symbols-outlined">schedule</span> Başlat</button>
                    <button id="timer-pause-btn" onclick="pauseTimer()" style="display:none;"><span class="material-symbols-outlined">pause_circle</span> Duraklat</button>
                    <button onclick="resetTimer()"><span class="material-symbols-outlined">restart_alt</span> Sıfırla</button>
                </div>
            </div>
        </div>

        <div id="calendar" class="tab-content">
            <div class="widget-card">
                <h2>Takvim</h2>
                <div class="takvim-baslik">
                    <button onclick="takvimiDegistir(-1)"> &lt; </button>
                    <div id="takvim-ay-yil" style="color: var(--secondary-color);"></div>
                    <button onclick="takvimiDegistir(1)"> &gt; </button>
                </div>
                <div class="takvim-gunler" style="color: var(--secondary-color);">
                    <div class="takvim-gun">Pzt</div>
                    <div class="takvim-gun">Sal</div>
                    <div class="takvim-gun">Çar</div>
                    <div class="takvim-gun">Per</div>
                    <div class="takvim-gun">Cum</div>
                    <div class="takvim-gun">Cmt</div>
                    <div class="takvim-gun">Paz</div>
                </div>
                <div id="takvim-hucreler" class="takvim-gunler">
                    </div>
            </div>

            <div class="widget-card">
                <h2>Seçilen Günün Görevleri (<span id="secilen-tarih-gostergesi" style="color: var(--primary-color);">Bugün</span>)</h2>
                <div class="gorev-ekle">
                    <input type="text" id="gorev-metni" placeholder="Görevi buraya yazın..." style="flex: 2;">
                    <input type="time" id="gorev-alarm-saati" value="09:00" style="width: 100px;">
                    <button onclick="gorevEkle()">
                        <span class="material-symbols-outlined">add_task</span> Ekle
                    </button>
                </div>
                <ul id="gorev-listesi" style="padding: 0; list-style: none;">
                    </ul>
            </div>

            <div class="widget-card">
                <h2>Hızlı Notlar (Kalıcı)</h2>
                <textarea id="not-alani" placeholder="Buraya genel notlarınızı yazın. Tarayıcınız kapatılsa bile bu notlar saklanacaktır."></textarea>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="widget-card">
                <h2>Hazır Tema Seçimi</h2>
                <div class="settings-grid">
                    
                    <div class="theme-card" data-theme="deep-blue">
                        <div class="theme-preview" style="background-color: #0a192f; color: #64ffda; border-color: #64ffda;">Deep Blue</div>
                        <button class="theme-select-btn" onclick="temayiUygula('deep-blue')">
                            <span class="material-symbols-outlined">style</span> Deep Blue Uygula
                        </button>
                    </div>

                    <div class="theme-card" data-theme="red-matrix">
                        <div class="theme-preview" style="background-color: #000000; color: #ff4d4d; border-color: #ff4d4d;">Siyah Kırmızı (Matrix)</div>
                        <button class="theme-select-btn" onclick="temayiUygula('red-matrix')">
                            <span class="material-symbols-outlined">style</span> Siyah Kırmızı Uygula
                        </button>
                    </div>
                    
                    <div class="theme-card" data-theme="light-mint">
                        <div class="theme-preview" style="background-color: #f0fff4; color: #3cb371; border-color: #3cb371;">Hafif Yeşil (Mint)</div>
                        <button class="theme-select-btn" onclick="temayiUygula('light-mint')">
                            <span class="material-symbols-outlined">style</span> Hafif Yeşil Uygula
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <a class="nav-item active" data-tab="home"><span class="material-symbols-outlined">home</span><span>Ana Sayfa</span></a>
        <a class="nav-item" data-tab="time_management"><span class="material-symbols-outlined">timer</span><span>Zaman Yön.</span></a>
        <a class="nav-item" data-tab="calendar"><span class="material-symbols-outlined">edit_calendar</span><span>Takvim/Not</span></a>
        <a class="nav-item" data-tab="settings"><span class="material-symbols-outlined">palette</span><span>Ayarlar</span></a>
    </div>

    <audio id="alarm-sesi" src="https://cdn.pixabay.com/download/audio/2023/06/17/audio_22822a16d8.mp3?filename=notification-sound-129285.mp3" preload="auto"></audio>

    <script>
        // **************** TEMEL DEĞİŞKENLER VE AYARLAR ****************
        const GOREV_KEY = 'minimal_koyu_gorevler';
        const NOT_KEY = 'minimal_koyu_notlar_v2';
        const THEME_NAME_KEY = 'active_theme_name';
        
        // TEMALARIN TANIMI
        const THEMES = {
            'deep-blue': { bgColor: '#0a192f', textColor: '#ccd6f6', primaryColor: '#64ffda', secondaryColor: '#ccd6f6', cardBg: '#112240', errorColor: '#ff6464' },
            'red-matrix': { bgColor: '#000000', textColor: '#f0f0f0', primaryColor: '#ff4d4d', secondaryColor: '#ff4d4d', cardBg: '#111111', errorColor: '#ff0000' },
            'light-mint': { bgColor: '#f0fff4', textColor: '#2f4f4f', primaryColor: '#3cb371', secondaryColor: '#6b8e23', cardBg: '#ffffff', errorColor: '#dc143c' }
        };
        const DEFAULT_THEME_NAME = 'deep-blue';

        let gorevler = JSON.parse(localStorage.getItem(GOREV_KEY)) || {};
        let aktifTarih = new Date(); // Takvimin gösterdiği ay/yıl
        let secilenTarih = new Date(); // Görevlerin görüntülendiği tarih
        let alarmKontrolInterval;
        const alarmSesi = document.getElementById('alarm-sesi');

        // **************** YARDIMCI FONKSİYONLAR ****************
        function tarihFormatla(date) { const y = date.getFullYear(); const m = String(date.getMonth() + 1).padStart(2, '0'); const d = String(date.getDate()).padStart(2, '0'); return `${y}-${m}-${d}`; }
        function formatTime(ms) { const totalSeconds = Math.floor(ms / 1000); const hours = String(Math.floor(totalSeconds / 3600)).padStart(2, '0'); const minutes = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0'); const seconds = String(totalSeconds % 60).padStart(2, '0'); return `${hours}:${minutes}:${seconds}`; }
        function formatSeconds(totalSeconds) { return formatTime(totalSeconds * 1000); }

        // **************** TEMA YÖNETİMİ ****************
        function temayiUygula(themeName) {
            const settings = THEMES[themeName];
            if (!settings) return;

            const root = document.documentElement;
            root.style.setProperty('--bg-color', settings.bgColor);
            root.style.setProperty('--text-color', settings.textColor);
            root.style.setProperty('--primary-color', settings.primaryColor);
            root.style.setProperty('--secondary-color', settings.secondaryColor);
            root.style.setProperty('--card-bg', settings.cardBg);
            root.style.setProperty('--error-color', settings.errorColor);
            root.style.setProperty('--delete-button-color', settings.errorColor); // Silme butonu için
            
            localStorage.setItem(THEME_NAME_KEY, themeName);
            temayiAktifGoster(themeName);
        }

        function temayiAktifGoster(activeThemeName) {
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('active');
                if (card.getAttribute('data-theme') === activeThemeName) {
                    card.classList.add('active');
                }
            });
        }
        
        // **************** SEKMELER VE GENEL KONTROL ****************
        function gosterSekme(tabId) { 
            document.querySelectorAll('.tab-content').forEach(content => { content.classList.remove('active'); });
            document.getElementById(tabId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(item => { item.classList.remove('active'); });
            document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');

            if (tabId !== 'time_management') { pauseStopwatch(); pauseTimer(); }
            if (tabId === 'calendar') { gorevleriYukle(tarihFormatla(secilenTarih)); takvimiOlustur(aktifTarih); }
        }
        document.querySelectorAll('.nav-item').forEach(item => { item.addEventListener('click', function() { gosterSekme(this.getAttribute('data-tab')); }); });

        // **************** SAAT VE TARİH ****************
        function saatiGuncelle() {
            const now = new Date();
            const saatGostergesi = document.getElementById('saat-gostergesi');
            const tarihGostergesi = document.getElementById('tarih-gostergesi');
            if (saatGostergesi && tarihGostergesi) {
                const saat = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                const tarih = now.toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                saatGostergesi.textContent = saat;
                tarihGostergesi.textContent = tarih;
            }
        }
        setInterval(saatiGuncelle, 1000);

        // **************** NOTLAR ****************
        const notAlani = document.getElementById('not-alani');
        // Notları yükle
        if(notAlani) notAlani.value = localStorage.getItem(NOT_KEY) || '';
        // Değişiklikleri kaydet
        if(notAlani) notAlani.addEventListener('input', () => { localStorage.setItem(NOT_KEY, notAlani.value); });

        // **************** GÖREVLER, TAKVİM VE ALARM ****************
        function izinIste() { if (!("Notification" in window)) return; if (Notification.permission !== "granted") { Notification.requestPermission(); } }
        function alarmCal(gorevMetni) { 
            alarmSesi.currentTime = 0; // Sesin baştan çalmasını sağla
            alarmSesi.play().catch(e => console.error("Ses çalınamadı:", e)); 
            if ("Notification" in window && Notification.permission === "granted") { 
                new Notification("GÖREV ALARMI!", { body: `Zamanı Geldi: ${gorevMetni}`, icon: "https://fonts.gstatic.com/s/materialsymbolsoutlined/v164/vSgAU_MofcQo7pOHiLh35QNnJ-Y0p8E_5Gf4x4yO3w.woff2" }); 
            } else { 
                alert(`Alarm! Görev zamanı geldi: ${gorevMetni}`); 
            } 
        }
        
        function alarmKontrolEt() { 
            const simdi = new Date(); 
            // Alarm kontrolünü her 5 saniyede bir yaptığımız için saniye kısmı sıfır varsayılır.
            const simdiSaatStr = `${String(simdi.getHours()).padStart(2, '0')}:${String(simdi.getMinutes()).padStart(2, '0')}`; 
            
            // Bugün için görevleri kontrol et
            const simdiTarihStr = tarihFormatla(simdi); 
            if (gorevler[simdiTarihStr]) { 
                gorevler[simdiTarihStr].forEach(gorev => { 
                    // Alarm saati dolmuşsa ve daha önce çalmadıysa
                    if (gorev.alarm === simdiSaatStr && !gorev.caldi) { 
                        // Saniye 0-4 arasındayken sadece bir kez çalsın
                        if (simdi.getSeconds() < 5) {
                            alarmCal(gorev.metin); 
                            gorev.caldi = true; 
                            gorevleriKaydet(); 
                        }
                    } 
                }); 
            } 
        }

        function alarmKontrolBaslat() { 
            if (alarmKontrolInterval) clearInterval(alarmKontrolInterval); 
            alarmKontrolInterval = setInterval(alarmKontrolEt, 5000); 
        }
        
        function gorevleriKaydet() { 
            localStorage.setItem(GOREV_KEY, JSON.stringify(gorevler)); 
            takvimiOlustur(aktifTarih); // Takvim hücrelerindeki görevli işaretini güncelle
        }
        
        function gorevleriYukle(tarihStr) { 
            const gorevListesiUL = document.getElementById('gorev-listesi');
            const gorevlerBugun = gorevler[tarihStr] || [];
            gorevListesiUL.innerHTML = '';
            document.getElementById('secilen-tarih-gostergesi').textContent = tarihStr === tarihFormatla(new Date()) ? "Bugün" : tarihStr;
            
            if (gorevlerBugun.length === 0) { 
                gorevListesiUL.innerHTML = `<li style="opacity: 0.6; text-align: center;">Bu güne ait görev bulunmamaktadır.</li>`; 
                return; 
            }
            
            gorevlerBugun.forEach((gorev, index) => {
                const li = document.createElement('li');
                li.className = 'gorev-item';
                
                // Tamamlanma özelliği kodda bulunmadığı için kaldırıldı. İstenirse eklenebilir.
                li.innerHTML = `
                    <div class="gorev-detay">
                        <strong>${gorev.metin}</strong>
                        <span class="gorev-alarm">
                            <span class="material-symbols-outlined" style="font-size: 14px;">alarm</span> Alarm: ${gorev.alarm}
                        </span>
                    </div>
                    <button class="gorev-sil-btn" onclick="gorevSil('${tarihStr}', ${index})">
                        <span class="material-symbols-outlined">delete</span>
                    </button>`;
                gorevListesiUL.appendChild(li);
            });
        }
        
        function gorevEkle() {
            const metinInput = document.getElementById('gorev-metni'); 
            const alarmInput = document.getElementById('gorev-alarm-saati'); 
            const metin = metinInput.value.trim(); 
            const alarmSaati = alarmInput.value; 
            const tarihStr = tarihFormatla(secilenTarih);

            if (metin === "") { alert("Lütfen bir görev metni girin."); return; }
            
            if (!gorevler[tarihStr]) { gorevler[tarihStr] = []; }
            
            // Her görev eklendiğinde alarm çalmadı olarak işaretlenmeli
            gorevler[tarihStr].push({ metin: metin, alarm: alarmSaati, tamamlandi: false, caldi: false });
            
            metinInput.value = ""; 
            gorevleriKaydet(); 
            gorevleriYukle(tarihStr);
        }
        
        function gorevSil(tarihStr, index) { 
            if (confirm("Bu görevi silmek istediğinizden emin misiniz?")) { 
                if (gorevler[tarihStr]) { 
                    gorevler[tarihStr].splice(index, 1); 
                    if (gorevler[tarihStr].length === 0) { 
                        delete gorevler[tarihStr]; 
                    } 
                    gorevleriKaydet(); 
                    gorevleriYukle(tarihStr); 
                } 
            } 
        }

        function takvimiOlustur(date) { 
            const yil = date.getFullYear(); 
            const ay = date.getMonth(); 
            const bugun = new Date(); 
            const ayIsimleri = ["Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];
            
            const ayYilGostergesi = document.getElementById('takvim-ay-yil'); 
            const takvimHucreler = document.getElementById('takvim-hucreler');
            if (!ayYilGostergesi || !takvimHucreler) return; 
            
            ayYilGostergesi.textContent = `${ayIsimleri[ay]} ${yil}`;
            
            const ayinIlkGunu = new Date(yil, ay, 1); 
            // 0=Pazar, 1=Pazartesi... 6=Cumartesi. Pazartesi'den başlaması için ayarlandı
            let baslangicGunu = ayinIlkGunu.getDay(); 
            if (baslangicGunu === 0) baslangicGunu = 7; 
            
            const gunSayisi = new Date(yil, ay + 1, 0).getDate(); 
            takvimHucreler.innerHTML = ''; 
            
            // Boşlukları ekle (Pazartesi'den başlaması için)
            for (let i = 1; i < baslangicGunu; i++) { 
                const hucre = document.createElement('div'); 
                hucre.classList.add('takvim-hucre', 'bos'); 
                takvimHucreler.appendChild(hucre); 
            }
            
            // Günleri ekle
            for (let i = 1; i <= gunSayisi; i++) {
                const hucre = document.createElement('div'); 
                hucre.classList.add('takvim-hucre', 'dolu'); 
                hucre.textContent = i;
                
                const oAnkiGun = new Date(yil, ay, i); 
                const tarihStr = tarihFormatla(oAnkiGun);
                
                // Bugünü işaretle
                if (oAnkiGun.toDateString() === bugun.toDateString()) { 
                    hucre.classList.add('bugun'); 
                }
                
                // Seçili Günü işaretle (Yeni: 'secili' sınıfı kullanıldı)
                if (oAnkiGun.toDateString() === secilenTarih.toDateString()) { 
                    hucre.classList.add('secili');
                }
                
                // Görevli günleri işaretle
                if (gorevler[tarihStr] && gorevler[tarihStr].length > 0) { 
                    hucre.classList.add('gorevli'); 
                }
                
                hucre.onclick = () => { 
                    secilenTarih = oAnkiGun; 
                    gorevleriYukle(tarihFormatla(secilenTarih)); // Seçilen tarihin görevlerini yükle
                    takvimiOlustur(aktifTarih); // Seçili işareti güncellemek için takvimi yeniden oluştur
                };
                
                takvimHucreler.appendChild(hucre);
            }
        }

        function takvimiDegistir(delta) { 
            aktifTarih.setMonth(aktifTarih.getMonth() + delta); 
            takvimiOlustur(aktifTarih); 
        }
        
        // **************** KRONOMETRE VE ZAMANLAYICI ****************
        // Kronometre
        let swInterval; 
        let swRunning = false; 
        let swElapsedTime = 0; 
        const swDisplay = document.getElementById('stopwatch-display'); 
        const swStartBtn = document.getElementById('sw-start-btn'); 
        const swPauseBtn = document.getElementById('sw-pause-btn');
        function startStopwatch() { 
            if (swRunning) return; 
            swRunning = true; 
            const swStartTime = Date.now() - swElapsedTime; 
            swInterval = setInterval(() => { 
                swElapsedTime = Date.now() - swStartTime; 
                swDisplay.textContent = formatTime(swElapsedTime); 
            }, 1000); 
            swStartBtn.style.display = 'none'; 
            swPauseBtn.style.display = 'inline-flex'; 
        }
        function pauseStopwatch() { 
            if (!swRunning) return; 
            swRunning = false; 
            clearInterval(swInterval); 
            swStartBtn.style.display = 'inline-flex'; 
            swPauseBtn.style.display = 'none'; 
        }
        function resetStopwatch() { 
            pauseStopwatch(); 
            swElapsedTime = 0; 
            swDisplay.textContent = formatTime(swElapsedTime); 
        }

        // Zamanlayıcı (Timer)
        let timerInterval; 
        let timerRunning = false; 
        let remainingSeconds = 300; 
        let initialSeconds = 300; 
        const timerDisplay = document.getElementById('timer-display'); 
        const timerStartBtn = document.getElementById('timer-start-btn'); 
        const timerPauseBtn = document.getElementById('timer-pause-btn'); 
        const hInput = document.getElementById('timer-hours'); 
        const mInput = document.getElementById('timer-minutes'); 
        const sInput = document.getElementById('timer-seconds');
        
        function updateRemainingTime() { 
            if (remainingSeconds <= 0) { 
                clearInterval(timerInterval); 
                timerRunning = false; 
                timerDisplay.textContent = "00:00:00"; 
                alarmCal("Geri Sayım Zamanlayıcısı Sona Erdi!"); 
                timerStartBtn.style.display = 'inline-flex'; 
                timerPauseBtn.style.display = 'none'; 
                return; 
            } 
            timerDisplay.textContent = formatSeconds(remainingSeconds); 
            remainingSeconds--; 
        }
        
        function setInitialTime() { 
            // Giriş değerlerini temizle ve toplam saniyeyi hesapla
            const hours = parseInt(hInput.value) || 0; 
            const minutes = parseInt(mInput.value) || 0; 
            const seconds = parseInt(sInput.value) || 0; 
            
            const newTotalSeconds = (hours * 3600) + (minutes * 60) + seconds; 
            
            if (newTotalSeconds > 0) { 
                initialSeconds = newTotalSeconds; 
                remainingSeconds = newTotalSeconds; 
            } else { 
                initialSeconds = 0; 
                remainingSeconds = 0;
            } 
            
            // Eğer zamanlayıcı çalışmıyorsa, göstergeyi yeni başlangıç süresiyle güncelle
            if(!timerRunning) {
                timerDisplay.textContent = formatSeconds(remainingSeconds);
            }
        }
        
        // Giriş değişikliklerinde zamanlayıcıyı duraklat ve başlangıç süresini ayarla
        [hInput, mInput, sInput].forEach(input => { 
            input.addEventListener('input', () => { 
                pauseTimer(); 
                setInitialTime(); 
            }); 
        });
        
        function startTimer() { 
            if (timerRunning) return; 
            // Başlatmadan önce süreyi ayarla (kullanıcı girişleri değiştirdiyse)
            setInitialTime(); 

            if (remainingSeconds <= 0) { 
                alert("Lütfen geçerli bir geri sayım süresi girin.");
                return; 
            } 
            
            timerRunning = true; 
            timerInterval = setInterval(updateRemainingTime, 1000); 
            timerStartBtn.style.display = 'none'; 
            timerPauseBtn.style.display = 'inline-flex'; 
        }
        
        function pauseTimer() { 
            if (!timerRunning) return; 
            timerRunning = false; 
            clearInterval(timerInterval); 
            timerStartBtn.style.display = 'inline-flex'; 
            timerPauseBtn.style.display = 'none'; 
        }
        
        function resetTimer() { 
            pauseTimer(); 
            remainingSeconds = initialSeconds; 
            timerDisplay.textContent = formatSeconds(remainingSeconds); 
            
            // Giriş kutularını da başlangıç değerlerine getir
            hInput.value = Math.floor(initialSeconds / 3600); 
            mInput.value = Math.floor((initialSeconds % 3600) / 60); 
            sInput.value = initialSeconds % 60;
        }

        // **************** İLK BAŞLATMA İŞLEMLERİ ****************
        // Tema hemen yüklenmeli, bu sayede arka plan beyaz kalmaz.
        const savedThemeOnLoad = localStorage.getItem(THEME_NAME_KEY) || DEFAULT_THEME_NAME;
        temayiUygula(savedThemeOnLoad); // <-- Arka plan sorununu çözen ana değişiklik

        // Sayfa yüklendikten sonra aktif temayı ayarlar sekmesinde işaretle
        window.addEventListener('load', () => temayiAktifGoster(localStorage.getItem(THEME_NAME_KEY) || DEFAULT_THEME_NAME));

        saatiGuncelle();
        setInitialTime(); 
        takvimiOlustur(aktifTarih); 
        gorevleriYukle(tarihFormatla(secilenTarih)); 
        
        izinIste(); 
        alarmKontrolBaslat();
    </script>
</body>
</html>
